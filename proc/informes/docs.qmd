---
title: "Más allá del desempeño. Brechas de autoeficacia tecnológica y composición de género en contextos escolares chilenos"
author: Juan Carlos Castillo, Daniel Miranda y Nicolás Tobar
bibliography: ../../input/bib/icils_nudos.bib 
csl: ../../input/bib/apa.csl

knitr:
  opts_chunk: 
    collapse: true
    comment: "#>" 
    R.options:
      knitr.graphics.auto_pdf: true
      
format: 
  revealjs:
    logo: images/banner_nudos.jpg
    slide-number: true
    theme: [pp.scss]
    title-slide-attributes:
      data-background-image: images/portada.jpg
      data-background-size: cover
      
editor: visual
---

```{r}
options(digits = 2) #round results to 2 digits

nudos_color_binary <- c("#5f5758","#ff3057") #Nudos theme

pacman::p_load(tidyverse, #Data manipulation
               stargazer, #Descriptive tables
               sjmisc, #Descriptive tables
               knitr, #Markdown
               corrr, #Correlation matrix
               sjlabelled, #Labels manipulation
               sjPlot, #View_df table
               Hmisc, #Manipulate labels
               ggplot2, #Plots
               hrbrthemes, #Plot themes
               labelled, #Manipulate labels
               ggExtra, #Marginal plots
               gt, #Tables
               googlesheets4, #open sheets google
               summarytools, #Summary tables
               haven, #read_sav
               corrplot, #Plot corr
               lme4, #Multilevel modelo
               interactions, #View multilevel interactions
               skimr #Descriptive tables
               )

data <- readRDS("../../input/proc_data/03_student_proc_2018.rds")

#Student level
student <- data %>% select(starts_with("s_"))

#School level
school <- data %>% select(starts_with("c_"),idschool) %>% group_by(idschool) %>% 
                  summarise(across(everything(),~ mean(.x, na.rm = TRUE))) %>% ungroup() %>%
                  select(-idschool)

#Recode HISCED
student <- student %>% mutate(s_hisced=ifelse(to_numeric(s_hisced)==4,1,0))
```

# Introducción

## Problema

::: incremental
-   Masificación TICS y diferencias de uso por género [@hargittaiDifferencesActualPerceived2006;@punterGenderDifferencesComputer2017].
-   La sociología de brechas digitales enfocadas en recursos y desempeño. @rosaResonanciaSociologiaRelacion2019 enfatiza en las relaciones logradas con las TIC.
-   Rol de expectativas de autoeficacia en la autodeterminación individual y la valoración del entorno [@ryanSelfdeterminationTheoryFacilitation2000].
-   Encuesta ICILS IEA [@gebhardtGenderDifferencesComputer2019]:
    -   En 2013 Y 2018 las mujeres lograron puntajes más altos que los hombres. **En Chile estas diferencias tienden a no ser significativas**.
    -   Hombres reportan mayor autoeficacia avanzada, pero correlaciona menos con el puntaje del test que en las mujeres. Subestimación femenina.

:::

## Identidad, grupos de referencia y estereotipo

::: incremental

-   Teorías de Grupos de referencia y Amenaza del esterotipo [@turnerSocialIdentityTheory2004;@steeleStereotypeThreatIntellectual1995].
-   Evidencia de refuerzo parental y estudiantil del estereotipo de género con las tecnologías en Grecia [@vekiriGenderIssuesTechnology2008]. Valoración social de las tecnologías.
-   Estudios de composición de género: Hallazgos demuestran que las mujeres aumentan su rendimiento y satisfacción laboral y académica cuando están rodeadas de directivas y colegas mujeres [@kirschGenderCompositionCorporate2018].
    -   Ausencia de estudios de composición con ICILS y oportunidad de aproximarse a este efecto multinivel.
    
:::

# Pregunta

**¿Cómo la composición de género del establecimiento y las actitudes hacia las tecnologías afectan las expectativas de autoeficacia sobre las tecnologías de los hombres y las mujeres estudiantes de octavo básico en Chile?**

## Modelo Analítico {.smaller}

<div style="text-align: center;">
![](images/nivel1_diagram.png)
</div>

## Modelo Analítico {.smaller}

<div style="text-align: center;">
![](images/multilevel_diagram.png)
</div>

## Datos ICILS
::: columns

:::{.column width="40%"}
-   Medición en noviembre 2017, Publicación 2018.
-   Participan 46.561 estudiantes 8vo básico de 2226 colegios alrededor de 12 países[^1].
-   Muestra compleja trietápica.
-   Test CIL y cuestionario sobre acceso, uso, percepciones y actitudes a las TIC.

:::

:::{.column width="60%"}

```{r}
rbind(
skim(student[,1:8])%>%as.data.frame()%>%
  select(Variable=skim_variable,"Media/%"=numeric.mean,"Sd"=numeric.sd,
         P25=numeric.p25,P75=numeric.p75,
         Hist=numeric.hist,Missing=n_missing)%>%
  mutate_at(c("Sd","P25","P75","Hist"),~ifelse(Variable%in%c("s_sex","s_hisced"),NA,.))%>%
  mutate(Variable=dplyr::recode(Variable,
                                     "s_sex"="Sexo estudiante (1=mujer)",
                                     "s_geneff"="Autoeficacia General",
                                     "s_speceff"="Autoeficacia Específica",
                                     "s_hisced"="Nivel educacional parental (1=profesional)",
                                     "s_homlit"="Nivel alfabetización del hogar",
                                     "s_ictneg"="Valoración social negativa",
                                     "s_ictpos"="Valoración social positiva",
                                     "s_ictfut"="Expectativas de uso futuro"),
         Missing=paste0(round(Missing/3092*100,2),"%")),
  
 

skim(school%>%select(c_f_ratio_grade,c_p_sex))%>%as.data.frame()%>%
  select(Variable=skim_variable,"Media/%"=numeric.mean,"Sd"=numeric.sd,
         P25=numeric.p25,P75=numeric.p75,
         Hist=numeric.hist,Missing=n_missing)%>%
  mutate_at(c("Sd","P25","P75","Hist"),~ifelse(Variable=="c_p_sex",NA,.))%>%
  mutate(Variable=dplyr::recode(Variable,
                                     "c_f_ratio_grade"="Proporción femenina de estudiantes",
                                     "c_p_sex"="Género directivo (1=mujer)"),
         Missing=paste0(round(Missing/178*100,2),"%")))%>%
  
  gt()%>%
  sub_missing(missing_text = "") %>%
  tab_header(title = "Resumen descriptivo de variables")%>%
  tab_options(column_labels.font.size = 13,
              table.font.size = 13) %>%
  tab_row_group(label = "Nivel 2: Colegios (N=178)",
                rows = 9:10) %>%
  tab_row_group(label = "Nivel 1: Estudiantes (N=3092)",
                rows = 1:8) %>%
  tab_footnote(
    "Nota: Las cifras de 'Missing' se presentan como porcentajes del total de observaciones.",
    locations = cells_column_labels(columns = Missing))
```
:::
:::
[^1]: Chile, Dinamarca, Finlandia, Francia, Alemania, Italia, Kazajistán, Korea del sur, Portugal, Estados Unidos, Portugal y Uruguay.

# Nivel 1: Estudiantes


## Género, autoeficacia y valoración social

```{r}
data %>% group_by(to_label(s_sex)) %>% rename(gender="to_label(s_sex)")%>%
  summarise_at(c(autoeficacia_general="s_geneff",autoeficacia_especifica="s_speceff",
                 ict_positiva="s_ictpos",ict_negativa="s_ictneg",ict_futuro="s_ictfut"),
                 mean, na.rm = TRUE)%>%
  pivot_longer(cols = starts_with(c("auto","ict")),
               names_to = "indicadores",
               values_to = "puntaje")%>%
  mutate(indicadores=factor(indicadores, levels=c("ict_negativa",
                                                  "ict_positiva",
                                                  "ict_futuro",
                                                  "autoeficacia_general",
                                                  "autoeficacia_especifica"),
                                          labels=c("Valoración social negativa",
                                                   "Valoración social positiva",
                                                   "Expectativas de uso laboral o académico futuro",
                                                   "Autoeficacia en aplicaciones generales",
                                                   "Autoeficacia en aplicaciones específicas")))%>%
  
  ggplot(aes(x=to_label(puntaje),y=to_label(indicadores),color=gender))+
    geom_line(aes(group=to_label(indicadores)),color="#E7E7E7",linewidth=2.0)+
    geom_point(size=6)+
    theme_ipsum()+
    labs(x="Puntaje promedio",y="Indicadores",color="Género")+
    scale_color_manual(values=nudos_color_binary)+
    theme(legend.position = "top")+
    scale_y_discrete(labels=function(x) str_wrap(x,width = 40))
```

## Relaciones de varianza

::: panel-tabset

###### Hombres
```{r}
student %>% filter(s_sex==0) %>% 
  select("A. General"=s_geneff, "A. Específica"=s_speceff, "Expectativas uso futuro"=s_ictfut,
         "Valoración positiva"=s_ictpos,"Valoración negativa"=s_ictneg)%>%drop_na()%>%
  cor()%>%
  corrplot(method="square",diag = FALSE,type = "lower",addCoef.col = "#5f5758")
```

###### Mujeres
```{r}
student %>% filter(s_sex==1) %>% 
  select("A. General"=s_geneff, "A. Específica"=s_speceff, "Expectativas uso futuro"=s_ictfut,
         "Valoración positiva"=s_ictpos,"Valoración negativa"=s_ictneg)%>%drop_na()%>%
  cor()%>%
  corrplot(method="square",diag = FALSE,type = "lower",addCoef.col = "#5f5758")
```

:::

# Nivel 2: Escuelas

## Autoeficacia y establecimientos {.smaller}

::: panel-tabset
#### Autoeficacia General

```{r}
ggMarginal(school%>%mutate(c_p_sex=recode(c_p_sex,"1"="Mujer","0"="Hombre")) %>% drop_na(c_p_sex)%>%
             ggplot(aes(x=c_f_ratio_grade,y=c_geneff,color=c_p_sex))+
             geom_point(color="grey")+
             scale_color_manual(values = nudos_color_binary)+
             geom_smooth(method = "nls", formula = y ~ a * x + b, se = F,
             method.args = list(start = list(a = 0.1, b = 0.1)))+    
             theme_ipsum()+
             labs(x = "Ratio de mujeres 8vo básico (estimado)",
                  y = "Promedio por escuela de autoeficacia general",
                  color= "Género directivo")+
             theme(legend.position = "bottom")+
             scale_x_continuous(labels = scales::percent_format(scale = 100)),
           type = "boxplot")
```

#### Autoeficacia específica

```{r}
ggMarginal(school%>%mutate(c_p_sex=recode(c_p_sex,"1"="Mujer","0"="Hombre")) %>% drop_na(c_p_sex)%>%
             ggplot(aes(x=c_f_ratio_grade,y=c_speceff,color=c_p_sex))+
             geom_point(color="grey")+
             scale_color_manual(values = nudos_color_binary)+
             geom_smooth(method = "nls", formula = y ~ a * x + b, se = F,
             method.args = list(start = list(a = 0.1, b = 0.1)))+    
             theme_ipsum()+
             labs(x = "Ratio de mujeres 8vo básico (estimado)",
                  y = "Promedio por escuela de autoeficacia general",
                  color= "Género directivo")+
             theme(legend.position = "bottom")+
             scale_x_continuous(labels = scales::percent_format(scale = 100)),
           type = "boxplot")
```
:::

## Relaciones de varianza

```{r}
school %>% 
  select("A. General"=c_geneff, "A. Específica"=c_speceff, "Proporción femenina"=c_f_ratio_grade,
         "Género directivo"=c_p_sex)%>%drop_na()%>%
  cor()%>%
  corrplot(method="square",diag = FALSE,type = "lower",addCoef.col = "#5f5758")
```

# Modelos multinivel

## Modelos nulos {.smaller}

```{r, results='asis'}
data <- data %>% mutate_all(as.numeric)
label(data[["s_geneff"]]) <- "Autoeficacia General"
label(data[["s_speceff"]]) <- "Autoeficacia Específica"
label(data[["s_sex"]]) <- "Género Estudiante (mujer=1)"
label(data[["s_ictfut"]]) <- "Expectativa uso futuro"
label(data[["s_ictpos"]]) <- "Valoración positiva"
label(data[["s_ictneg"]]) <- "Valoración negativa"
label(data[["s_hisced"]]) <- "Nivel Educacional padres (superior=1)"
label(data[["s_homlit"]]) <- "Alfabetización del hogar"
label(data[["c_f_ratio_grade"]]) <- "Proporción Femenina"
label(data[["c_p_sex"]]) <- "Género directivo (mujer=1)"

m0_geneff <- lmer(s_geneff ~ 1  +  (1 | idschool),  data=data)
m0_speceff <- lmer(s_speceff ~ 1  +  (1 | idschool),  data=data)

sjPlot::tab_model(m0_geneff, m0_speceff, 
                  show.ci = FALSE, p.style = "stars",
                  show.re.var = FALSE,
                  collapse.se = TRUE,
                  show.r2 = FALSE)
```

## Nivel 1 {.smaller .scrollable}

```{r, results='asis'}
m1_geneff <- lm(s_geneff ~ 
                  s_sex + s_ictfut + s_ictpos + s_ictneg +
                  s_hisced + s_homlit,  data=data)

m1_speceff <- lm(s_speceff ~ 
                  s_sex + s_ictfut + s_ictpos + s_ictneg +
                  s_hisced + s_homlit,  data=data)

tab_model(m1_geneff, m1_speceff, 
          show.ci = FALSE, auto.label = TRUE,
          p.style = "stars",collapse.se = TRUE,
          show.re.var = FALSE,show.icc = FALSE,
          show.obs = FALSE,show.ngroups = FALSE)

```

## Multinivel pendiente fija {.smaller}

```{r, results='asis'}
m1_1_geneff <- lmer(s_geneff ~ 
                  c_f_ratio_grade + c_p_sex +
                  s_sex + s_ictfut + s_ictpos + s_ictneg +
                  s_hisced + s_homlit +
                  (1 | idschool),  data=data)

m1_1_speceff <- lmer(s_speceff ~ 
                  c_f_ratio_grade + c_p_sex +
                  s_sex + s_ictfut + s_ictpos + s_ictneg +
                  s_hisced + s_homlit +
                  (1 | idschool),  data=data)

tab_model(m1_1_geneff, m1_1_speceff, 
          show.ci = FALSE, auto.label = TRUE,
          p.style = "stars",collapse.se = TRUE,
          show.re.var = FALSE,show.icc = FALSE,
          show.obs = FALSE,show.ngroups = FALSE,
          terms = c("c_f_ratio_grade","c_p_sex","s_sex",
                    "s_ictfut","s_ictpos","s_ictneg"))

```
::: aside
Nota: Se excluyen variables de control en la tabla.
:::

## Pendiente aleatoria con moderación {.smaller .scrollable}

```{r, results='asis'}
m2_geneff <- lmer(s_geneff ~ 
                  s_sex*c_f_ratio_grade + s_sex*c_p_sex +
                  c_f_ratio_grade + c_p_sex +
                  s_sex + s_ictfut + s_ictpos + s_ictneg +
                  s_hisced + s_homlit +
                  (1 + s_sex| idschool), data=data)

m2_speceff <- lmer(s_speceff ~ 
                  s_sex*c_f_ratio_grade + s_sex*c_p_sex +
                  c_f_ratio_grade + c_p_sex +
                  s_sex + s_ictfut + s_ictpos + s_ictneg +
                  s_hisced + s_homlit +
                  (1 + s_sex| idschool), data=data)

tab_model(m2_geneff, m2_speceff, 
          show.ci = FALSE, auto.label = TRUE,
          p.style = "stars", collapse.se = TRUE,
          terms = c("s_sex","c_f_ratio_grade","c_p_sex",
                    "s_sex:c_f_ratio_grade",
                    "s_sex:c_p_sex"))
```
::: aside
Nota: El modelo contiene todas las variables presentadas anteriormente, pero se excluyen de la tabla para facilitar entendimiento.
:::


## ¿Es relevante la composición de género? {.smaller}

#### Autoeficacia Específica

```{r, results='markup'}

interactions::interact_plot(m2_speceff, pred = s_sex, modx = c_f_ratio_grade,
                            colors = nudos_color_binary,legend.main = "Proporción femenina")+
  labs(x="Género", y="Puntaje A. Específica")

```
:::

## Verificación Hipótesis

<div style="text-align: center;">
![](images/conclusions.png)
</div>

## Discusión
-   ¿Qué hay entre medio de la moderación negativa en autoeficacia específica?
-   Limitaciones
    -   Composición de mujeres como categórica
    -   Factores de expansión
    -   Presentación explorativa (Causalidad actitudes-autoeficacia)
-   Nuevas agendas
    -   Explicar variación de actitudes por género
    -   Añadir tipos de usos y desempeño en la prueba (behavioral perspective)

## Referencias

::: {#refs}
:::

# Anexo

## Items de Indicadores

::: panel-tabset

#### Autoeficacia General
![](images/s_geneff.png)

#### Autoeficacia Específica
![](images/s_speceff.png)


#### Expectativas uso futuro

![](images/s_ictfut.png)

#### Valoración social positiva
![](images/s_ictpos.png)

#### Valoración social negativa
![](images/s_ictneg.png)

:::
